# ARCHITECTURE Рђћ NixOS Flake Dev Machine

рЃћрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў рЃљрЃдрЃгрЃћрЃарЃА **рЃарЃЮрЃњрЃЮрЃа рЃљрЃарЃўрЃА рЃљрЃгрЃДрЃЮрЃЉрЃўрЃџрЃў рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃерЃўрЃњрЃюрЃўрЃЊрЃљрЃю**.  
рЃљрЃарЃљ рЃўрЃюрЃАрЃбрЃљрЃџрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА, рЃљрЃарЃљрЃЏрЃћрЃЊ **рЃњрЃљрЃњрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА**.

рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃљрЃфрЃўрЃљ рЃњрЃљрЃюрЃЎрЃБрЃЌрЃЋрЃюрЃўрЃџрЃўрЃљ **NixOS 25.11+**-рЃўрЃАрЃЌрЃЋрЃўрЃА.

---

## ­Ъј» рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃЏрЃўрЃќрЃљрЃюрЃў

рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃЏрЃўрЃќрЃљрЃюрЃўрЃљ:

- рЃЏрЃЎрЃљрЃцрЃўрЃЮ рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљ
- рЃърЃљрЃАрЃБрЃ«рЃўрЃАрЃЏрЃњрЃћрЃЉрЃџрЃЮрЃЉрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃўрЃ»рЃЋрЃюрЃљ
- рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљрЃЊрЃў Flake
- рЃАрЃљрЃАрЃгрЃљрЃЋрЃџрЃЮрЃЊ рЃњрЃљрЃЏрЃЮрЃАрЃљрЃЊрЃћрЃњрЃў рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў

рЃћрЃА рЃљрЃа рЃљрЃарЃўрЃА РђърЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў рЃћрЃарЃЌ рЃцрЃљрЃўрЃџрЃерЃўРђю рЃЏрЃўрЃЊрЃњрЃЮрЃЏрЃљ.

---

## ­ЪДЕ Flake Рђћ рЃфрЃћрЃюрЃбрЃарЃљрЃџрЃБрЃарЃў рЃЎрЃЋрЃљрЃюрЃФрЃў

### flake.nix-рЃўрЃА рЃарЃЮрЃџрЃў

`flake.nix` рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА **рЃЎрЃЮрЃЮрЃарЃЊрЃўрЃюрЃљрЃбрЃЮрЃарЃўрЃА** рЃарЃЮрЃџрЃА:

- рЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃћрЃЉрЃА рЃДрЃЋрЃћрЃџрЃљ input-рЃА
- рЃњрЃљрЃюрЃАрЃљрЃќрЃдрЃЋрЃарЃљрЃЋрЃА outputs-рЃА
- рЃљрЃЎрЃљрЃЋрЃерЃўрЃарЃћрЃЉрЃА host-рЃА, system-рЃА рЃЊрЃљ Home Manager-рЃА

Flake **рЃљрЃа рЃерЃћрЃўрЃфрЃљрЃЋрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљрЃА**, рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃљрЃгрЃДрЃЮрЃЉрЃА рЃЎрЃЮрЃЏрЃърЃЮрЃюрЃћрЃюрЃбрЃћрЃЉрЃА.

---

## ­ЪЊд Inputs Рђћ рЃЎрЃЮрЃюрЃбрЃарЃЮрЃџрЃўрЃарЃћрЃЉрЃљрЃЊрЃў рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў

рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџрЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ:

- `nixpkgs` Рђћ рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃърЃљрЃЎрЃћрЃбрЃћрЃЉрЃў
- `home-manager` Рђћ user layer
- рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў inputs (рЃЌрЃБ рЃљрЃарЃўрЃА) Рђћ рЃЏрЃЎрЃљрЃцрЃўрЃЮрЃЊ рЃЊрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃћрЃЉрЃБрЃџрЃў

рЃърЃарЃўрЃюрЃфрЃўрЃърЃў:
> **рЃљрЃарЃљрЃюрЃљрЃўрЃарЃў implicit channel-рЃћрЃЉрЃў**

рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў version-locked рЃљрЃарЃўрЃА `flake.lock`-рЃерЃў.

---

## ­ЪД▒ Outputs Рђћ рЃарЃљрЃА рЃЦрЃЏрЃюрЃўрЃА flake

Flake-рЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў output рЃљрЃарЃўрЃА:

```nix
nixosConfigurations.laptop
````

рЃћрЃА рЃюрЃўрЃерЃюрЃљрЃЋрЃА:

* рЃћрЃарЃЌрЃў host = рЃћрЃарЃЌрЃў system definition
* host-рЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃарЃљрЃЋрЃџрЃћрЃЉрЃљ рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ

---

## ­ЪќЦ№ИЈ Host-based Architecture

### рЃарЃљрЃбрЃЮрЃЏ host-рЃћрЃЉрЃќрЃћ рЃЊрЃљрЃДрЃЮрЃцрЃљ?

рЃџрЃћрЃърЃбрЃЮрЃърЃў РЅа рЃЊрЃћрЃАрЃЎрЃбрЃЮрЃърЃў РЅа VM

рЃљрЃЏрЃўрЃбрЃЮрЃЏ:

```text
hosts/
 РћћРћђ laptop/
```

рЃЌрЃўрЃЌрЃЮ host рЃљрЃарЃўрЃА **рЃАрЃарЃБрЃџрЃў рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ**, рЃљрЃарЃљ рЃБрЃЉрЃарЃљрЃџрЃЮрЃЊ override.

---

### host/laptop/default.nix

рЃћрЃА рЃљрЃарЃўрЃА **host entry point**.

рЃљрЃЦ рЃўрЃЎрЃарЃўрЃЉрЃћрЃЉрЃљ:

* hardware
* users
* system modules
* desktop/services

default.nix **рЃљрЃа рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃњрЃљрЃЊрЃљрЃбрЃЋрЃўрЃарЃЌрЃБрЃџрЃў** Рђћ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃерЃћрЃЏрЃЎрЃарЃћрЃЉрЃў.

---

### host/laptop/hardware.nix

рЃљрЃЦ рЃљрЃарЃўрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ:

* hardware-specific рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў
* firmware
* CPU/GPU рЃАрЃърЃћрЃфрЃўрЃцрЃўрЃЎрЃљ
* disk / filesystem

рЃърЃарЃўрЃюрЃфрЃўрЃърЃў:

> hardware рЃўрЃфрЃЋрЃџрЃћрЃЉрЃљ рЃўрЃерЃЋрЃўрЃљрЃЌрЃљрЃЊ, рЃљрЃЏрЃўрЃбрЃЮрЃЏ рЃўрЃќрЃЮрЃџрЃўрЃарЃћрЃЉрЃБрЃџрЃўрЃљ

---

### host/laptop/users.nix

рЃљрЃЦ рЃњрЃљрЃюрЃўрЃАрЃљрЃќрЃдрЃЋрЃарЃћрЃЉрЃљ:

* users
* рЃЏрЃљрЃЌрЃў рЃ»рЃњрЃБрЃцрЃћрЃЉрЃў
* Home Manager рЃЏрЃўрЃЉрЃЏрЃљ

рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃўрЃљ:

* user РЅа system
* user configs рЃљрЃа рЃћрЃарЃћрЃЋрЃљ system modules-рЃерЃў

---

## ­ЪЉц Home Manager Рђћ User Layer

### рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃў рЃърЃЮрЃќрЃўрЃфрЃўрЃљ

Home Manager рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ рЃарЃЮрЃњрЃЮрЃарЃф:

> **User Environment Manager**, рЃљрЃарЃљ Desktop Owner

рЃљрЃюрЃБ:

* HM = tooling + workflow
* System = infrastructure

---

### home/user.nix

рЃљрЃЦ рЃЎрЃЮрЃюрЃцрЃўрЃњрЃБрЃарЃўрЃарЃЊрЃћрЃЉрЃљ:

* shell
* editor
* CLI tools
* user services

рЃљрЃЦ **рЃљрЃа рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА**:

* display manager
* window manager
* hardware
* networking

рЃћрЃА рЃерЃћрЃњрЃюрЃћрЃЉрЃБрЃџрЃў рЃерЃћрЃќрЃдрЃБрЃЊрЃЋрЃљрЃљ.

---

## ­Ъћђ Data Flow Рђћ рЃарЃЮрЃњрЃЮрЃа рЃћрЃгрЃДрЃЮрЃЉрЃљ рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ

рЃџрЃЮрЃ»рЃўрЃЎрЃБрЃарЃў рЃюрЃљрЃЎрЃљрЃЊрЃў:

```text
flake.nix
  РєЊ
nixosConfigurations.laptop
  РєЊ
hosts/laptop/default.nix
  РћюРћђ hardware.nix
  РћюРћђ users.nix
  РћћРћђ system modules
        РєЊ
Home Manager (user layer)
```

рЃДрЃЋрЃћрЃџрЃљ рЃцрЃћрЃюрЃљ рЃўрЃфрЃўрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃА, рЃарЃљрЃф рЃБрЃюрЃЊрЃљ рЃўрЃфрЃЮрЃЊрЃћрЃА.

---

## Рџа№ИЈ рЃњрЃљрЃЋрЃарЃфрЃћрЃџрЃћрЃЉрЃБрЃџрЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃў (Pitfalls)

### 1. WM Home Manager-рЃерЃў рЃњрЃљрЃЊрЃљрЃбрЃљрЃюрЃљ

* рЃљрЃарЃдрЃЋрЃћрЃЋрЃА system/user рЃАрЃљрЃќрЃдрЃЋрЃљрЃарЃА
* рЃљрЃарЃЌрЃБрЃџрЃћрЃЉрЃА debug-рЃА
* рЃЊрЃљрЃЏрЃгрЃДрЃћрЃЉрЃА рЃљрЃЉрЃюрЃћрЃЋрЃА

### 2. hardware рЃџрЃЮрЃњрЃўрЃЎрЃўрЃА рЃЕрЃљрЃДрЃарЃљ default.nix-рЃерЃў

* рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃБрЃџрЃљрЃЊ рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃўрЃљ
* рЃљрЃарЃЌрЃБрЃџрЃћрЃЉрЃА рЃАрЃ«рЃЋрЃљ host-рЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљрЃА

### 3. Flake-рЃерЃў рЃџрЃЮрЃњрЃўрЃЎрЃўрЃА рЃгрЃћрЃарЃљ

* flake РЅа module
* flake = wiring only

### 4. рЃДрЃЋрЃћрЃџрЃљрЃцрЃарЃўрЃА рЃћрЃарЃЌ user.nix-рЃерЃў рЃЕрЃљрЃДрЃарЃљ

* рЃўрЃќрЃарЃЊрЃћрЃЉрЃљ рЃбрЃћрЃЦрЃюрЃўрЃЎрЃБрЃарЃў рЃЋрЃљрЃџрЃў
* рЃарЃЌрЃБрЃџрЃЊрЃћрЃЉрЃљ рЃюрЃљрЃЋрЃўрЃњрЃљрЃфрЃўрЃљ

---

## ­ЪДа рЃарЃљрЃбрЃЮрЃЏ рЃљрЃарЃўрЃА рЃћрЃА рЃАрЃгрЃЮрЃарЃў dev-machine-рЃўрЃАрЃЌрЃЋрЃўрЃА

рЃћрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ:

* рЃўрЃФрЃџрЃћрЃЋрЃљ рЃАрЃбрЃљрЃЉрЃўрЃџрЃБрЃа рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃА
* рЃбрЃЮрЃЋрЃћрЃЉрЃА рЃЏрЃЮрЃЦрЃюрЃўрЃџ user рЃњрЃљрЃарЃћрЃЏрЃЮрЃА
* рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃўрЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃА рЃАрЃ«рЃЋрЃљ рЃЏрЃљрЃюрЃЦрЃљрЃюрЃљрЃќрЃћ
* рЃАрЃљрЃАрЃгрЃљрЃЋрЃџрЃЮрЃЊ рЃўрЃЊрЃћрЃљрЃџрЃБрЃарЃўрЃљ

---

## ­ЪЊї рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃюрЃљрЃЉрЃўрЃ»рЃў

рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃў:
­ЪЉЅ **`SETUP.md`**

рЃўрЃЦ рЃўрЃЦрЃюрЃћрЃЉрЃљ:

* Live ISO-рЃЊрЃљрЃю рЃЊрЃљрЃгрЃДрЃћрЃЉрЃљ
* Flake clone
* рЃърЃўрЃарЃЋрЃћрЃџрЃў rebuild
* рЃбрЃўрЃърЃБрЃарЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃћрЃЉрЃў рЃўрЃюрЃАрЃбрЃљрЃџрЃљрЃфрЃўрЃўрЃАрЃљрЃА

---

**рЃћрЃА рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃљ рЃљрЃарЃўрЃА рЃерЃћрЃњрЃюрЃћрЃЉрЃБрЃџрЃў рЃљрЃарЃЕрЃћрЃЋрЃљрЃюрЃў.
рЃљрЃарЃљ рЃЏрЃЮрЃЊрЃБрЃарЃў, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃњрЃљрЃЏрЃФрЃџрЃћ.**


